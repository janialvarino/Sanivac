<div class="form-card">
  <h3>üíâ Registro de Vacunaci√≥n</h3>

  <form (ngSubmit)="guardar()">
    <!-- B√∫squeda de Paciente -->
    <div class="form-section">
      <h4>üìã Datos del Paciente</h4>
      
      <label>N√∫mero de Identificaci√≥n del Paciente *</label>
      <input
        type="text"
        [(ngModel)]="vacuna.numero_id"
        name="numero_id"
        (blur)="buscarPaciente()"
        placeholder="Ingrese n√∫mero de identificaci√≥n"
        required
      />

      <div *ngIf="buscandoPaciente" class="mensaje-buscando">
        ‚è≥ Buscando paciente...
      </div>

      <div *ngIf="pacienteBuscado && !buscandoPaciente">
        <strong *ngIf="nombrePaciente !== 'No encontrado'">Paciente:</strong>
        <span *ngIf="nombrePaciente !== 'No encontrado'" class="paciente-encontrado">‚úÖ {{ nombrePaciente }}</span>
        <span *ngIf="nombrePaciente === 'No encontrado'" class="no-encontrado">‚ö†Ô∏è Paciente no encontrado</span>
      </div>

      <label>Tipo de Carnet</label>
      <input [(ngModel)]="vacuna.tipo_carnet" name="tipo_carnet" placeholder="Ej: Carnet Infantil" />
    </div>

    <!-- Datos de la Vacuna -->
    <div class="form-section">
      <h4>üíä Datos de la Vacuna</h4>
      
      <div class="form-row">
        <div>
          <label>Vacuna *</label>
          <select [(ngModel)]="vacuna.nombre_vacuna" name="nombre_vacuna" required>
            <option value="">Seleccione una vacuna</option>
            <option *ngFor="let v of vacunasDisponibles" [value]="v">{{ v }}</option>
          </select>
        </div>

        <div>
          <label>Laboratorio *</label>
          <select [(ngModel)]="vacuna.laboratorio" name="laboratorio" required>
            <option value="">Seleccione laboratorio</option>
            <option *ngFor="let lab of laboratorios" [value]="lab">{{ lab }}</option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div>
          <label>Dosis *</label>
          <input [(ngModel)]="vacuna.dosis" name="dosis" placeholder="Ej: 1, 2, Refuerzo" required />
        </div>

        <div>
          <label>Lote de Vacuna *</label>
          <input [(ngModel)]="vacuna.lote" name="lote" placeholder="N√∫mero de lote" required />
        </div>

        <div>
          <label>Diluyente *</label>
          <input [(ngModel)]="vacuna.diluyente" name="Nombre diluyente" placeholder="Diluyente" required />
        </div>
      </div>

      <div class="form-row">
        <div>
          <label>Lote Diluyente</label>
          <input [(ngModel)]="vacuna.lote_diluyente" name="lote_diluyente" placeholder="Si aplica" />
        </div>

        <div>
          <label>Lote Jeringa</label>
          <input [(ngModel)]="vacuna.lote_jeringa" name="lote_jeringa" placeholder="Si aplica" />
        </div>
      </div>

      <div class="form-row">
        <div>
          <label>Tipo de Jeringa</label>
          <select [(ngModel)]="vacuna.tipo_jeringa" name="tipo_jeringa">
            <option value="">Seleccione tipo</option>
            <option *ngFor="let tipo of tiposJeringa" [value]="tipo">{{ tipo }}</option>
          </select>
        </div>

        <div>
          <label>Fecha de Aplicaci√≥n *</label>
          <input [(ngModel)]="vacuna.fecha_aplicacion" name="fecha_aplicacion" type="date" required />
        </div>
      </div>
    </div>

    <!-- Datos de Aplicaci√≥n -->
    <div class="form-section">
      <h4>ü©π Datos de Aplicaci√≥n</h4>
      
      <div class="form-row">
        <div>
          <label>V√≠a de Administraci√≥n *</label>
          <select [(ngModel)]="vacuna.via_administracion" name="via_administracion" required>
            <option value="">Seleccione</option>
            <option value="INTRAMUSCULAR">Intramuscular</option>
            <option value="SUBCUT√ÅNEA">Subcut√°nea</option>
            <option value="ORAL">Oral</option>
            <option value="INTRAD√âRMICA">Intrad√©rmica</option>
          </select>
        </div>

        <div>
          <label>Sitio de Aplicaci√≥n *</label>
          <select [(ngModel)]="vacuna.sitio_aplicacion" name="sitio_aplicacion" required>
            <option value="">Seleccione</option>
            <option value="BRAZO DERECHO">Brazo Derecho</option>
            <option value="BRAZO IZQUIERDO">Brazo Izquierdo</option>
            <option value="MUSLO DERECHO">Muslo Derecho</option>
            <option value="MUSLO IZQUIERDO">Muslo Izquierdo</option>
            <option value="GL√öTEO">Gl√∫teo</option>
            <option value="ORAL">Oral</option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div>
          <label>Responsable *</label>
          <input [(ngModel)]="vacuna.responsable" name="responsable" placeholder="Nombre del aplicador" required />
        </div>

        <div>
          <label>Fecha Pr√≥xima Dosis</label>
          <input [(ngModel)]="vacuna.fecha_proxima_dosis" name="fecha_proxima_dosis" type="date" />
        </div>
      </div>
    </div>

    <!-- Observaciones -->
    <div class="form-section">
      <label>Observaciones</label>
      <textarea [(ngModel)]="vacuna.observaciones" name="observaciones" rows="3" placeholder="Observaciones adicionales (reacciones, contraindicaciones, etc.)"></textarea>
    </div>

    <!-- Botones -->
    <div class="actions">
      <button type="submit" class="btn-primary" [disabled]="guardando">
        <span *ngIf="!guardando">üíæ Guardar Registro</span>
        <span *ngIf="guardando">‚è≥ Guardando...</span>
      </button>
      <button type="button" class="btn-outline" (click)="cancelar()">‚ùå Cancelar</button>
    </div>
  </form>
</div>